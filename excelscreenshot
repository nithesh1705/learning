import win32com.client as win32
import os
from PIL import ImageGrab

def excel_range_to_colored_png(excel_path, output_path, sheet_name, range_address):
    # Start Excel
    excel = win32.gencache.EnsureDispatch('Excel.Application')
    excel.Visible = False

    # Open Workbook
    wb = excel.Workbooks.Open(os.path.abspath(excel_path))
    try:
        ws = wb.Sheets(sheet_name)

        # Copy range as picture
        ws.Range(range_address).CopyPicture(Format=win32.constants.xlBitmap)

        # Paste into a new ChartObject to access the image
        chart = ws.ChartObjects().Add(0, 0, 500, 500)
        chart.Chart.Paste()
        chart.Chart.Export(Filename=os.path.abspath(output_path), FilterName='PNG')
        chart.Delete()

        print(f"Screenshot saved as: {output_path}")

    finally:
        wb.Close(SaveChanges=False)
        excel.Quit()


excel_range_to_colored_png(
    "example.xlsx",
    "output.png",
    sheet_name="VERCAU",
    range_address="B3:H9"
)
